
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tree Coverage, Air Quality, and Complaints</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100%;
      height: 800px;
    }
    h2 {
      text-align: center;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <h2>NYC: Tree Coverage vs Air Quality vs Indoor Complaints</h2>
  <svg id="map" width="960" height="800"></svg>

  <script>
    const width = 960, height = 800;
    const svg = d3.select("#map");
    const projection = d3.geoMercator()
      .center([-73.94, 40.70])
      .scale(60000)
      .translate([width / 2, height / 2]);
    const path = d3.geoPath().projection(projection);

    // Sample air quality data
    const airData = [{"Geo Place Name": "Bay Ridge and Dyker Heights (CD10)", "Average_NO2": 18.4826550213}, {"Geo Place Name": "Bayside - Little Neck", "Average_NO2": 15.1905142685}, {"Geo Place Name": "Bayside Little Neck-Fresh Meadows", "Average_NO2": 15.6108484213}, {"Geo Place Name": "Bayside and Little Neck (CD11)", "Average_NO2": 17.680154603}, {"Geo Place Name": "Bedford Stuyvesant (CD3)", "Average_NO2": 19.1329976977}, {"Geo Place Name": "Bedford Stuyvesant - Crown Heights", "Average_NO2": 26.5715444782}, {"Geo Place Name": "Belmont and East Tremont (CD6)", "Average_NO2": 20.3671684901}, {"Geo Place Name": "Bensonhurst (CD11)", "Average_NO2": 17.0314930692}, {"Geo Place Name": "Bensonhurst - Bay Ridge", "Average_NO2": 16.1966225205}, {"Geo Place Name": "Borough Park", "Average_NO2": 16.7045221445}];

    // Sample complaints data
    const complaints = [{"Latitude": 40.707786, "Longitude": -73.756125}, {"Latitude": 40.80921, "Longitude": -73.944449}, {"Latitude": 40.728603, "Longitude": -73.978651}, {"Latitude": 40.728603, "Longitude": -73.978651}, {"Latitude": 40.80086, "Longitude": -73.954233}, {"Latitude": 40.776544, "Longitude": -73.954662}, {"Latitude": 40.764429, "Longitude": -73.988275}, {"Latitude": 40.730823, "Longitude": -74.005192}, {"Latitude": 40.638941, "Longitude": -73.943002}, {"Latitude": 40.755111, "Longitude": -73.881506}, {"Latitude": 40.74035, "Longitude": -74.003962}, {"Latitude": 40.691515, "Longitude": -73.937194}, {"Latitude": 40.833672, "Longitude": -73.94011}, {"Latitude": 40.64242, "Longitude": -73.979356}, {"Latitude": 40.714812, "Longitude": -74.016153}, {"Latitude": 40.609933, "Longitude": -73.910126}, {"Latitude": 40.720275, "Longitude": -74.003135}, {"Latitude": 40.865043, "Longitude": -73.90626}, {"Latitude": 40.720275, "Longitude": -74.003135}, {"Latitude": 40.701152, "Longitude": -73.909401}, {"Latitude": 40.760912, "Longitude": -73.807477}, {"Latitude": 40.760682, "Longitude": -73.936046}, {"Latitude": 40.615636, "Longitude": -73.974286}, {"Latitude": 40.889691, "Longitude": -73.858535}, {"Latitude": 40.818483, "Longitude": -73.953289}, {"Latitude": 40.738323, "Longitude": -73.868372}, {"Latitude": 40.781925, "Longitude": -73.955915}, {"Latitude": 40.747698, "Longitude": -74.002122}, {"Latitude": 40.802156, "Longitude": -73.957032}, {"Latitude": 40.690954, "Longitude": -73.959541}, {"Latitude": 40.784795, "Longitude": -73.948369}, {"Latitude": 40.717101, "Longitude": -73.838494}, {"Latitude": 40.676428, "Longitude": -73.880434}, {"Latitude": 40.766382, "Longitude": -73.909666}, {"Latitude": 40.700676, "Longitude": -73.919272}, {"Latitude": 40.822238, "Longitude": -73.940471}, {"Latitude": 40.644554, "Longitude": -73.901654}, {"Latitude": 40.840746, "Longitude": -73.942854}, {"Latitude": 40.656896, "Longitude": -73.917927}, {"Latitude": 40.592717, "Longitude": -73.994253}, {"Latitude": 40.737168, "Longitude": -73.858999}, {"Latitude": 40.711307, "Longitude": -73.983761}, {"Latitude": 40.800453, "Longitude": -73.969823}, {"Latitude": 40.762382, "Longitude": -73.98977}, {"Latitude": 40.768519, "Longitude": -73.987162}, {"Latitude": 40.803027, "Longitude": -73.965827}, {"Latitude": 40.773195, "Longitude": -73.946028}, {"Latitude": 40.724827, "Longitude": -73.980601}, {"Latitude": 40.623297, "Longitude": -74.000195}, {"Latitude": 40.775496, "Longitude": -73.962306}];

    // Sample tree data
    const trees = [{"latitude": 40.7128, "longitude": -74.006, "spc_common": "London planetree"}, {"latitude": 40.7228, "longitude": -74.001, "spc_common": "Callery pear"}, {"latitude": 40.7328, "longitude": -73.996, "spc_common": "Ginkgo"}];

    // Draw base map (CD outline)
    d3.json("https://raw.githubusercontent.com/dwillis/nyc-maps/master/community-districts.geojson").then(geoData => {
      const no2Map = new Map(airData.map(d => [d["Geo Place Name"], +d.Average_NO2]));
      const color = d3.scaleSequential(d3.interpolateReds)
        .domain([0, d3.max(airData, d => d.Average_NO2)]);

      svg.selectAll("path")
        .data(geoData.features)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("fill", d => color(no2Map.get(d.properties.ntaname) || 0))
        .attr("stroke", "#555")
        .attr("stroke-width", 0.2)
        .append("title")
        .text(d => d.properties.ntaname + " - NOâ‚‚: " + (no2Map.get(d.properties.ntaname) || "N/A"));

      // Tree dots (green)
      svg.selectAll("circle.tree")
        .data(trees)
        .enter()
        .append("circle")
        .attr("class", "tree")
        .attr("cx", d => projection([d.longitude, d.latitude])[0])
        .attr("cy", d => projection([d.longitude, d.latitude])[1])
        .attr("r", 3)
        .attr("fill", "green")
        .attr("opacity", 0.6)
        .append("title")
        .text(d => d.spc_common);

      // Complaint dots (blue)
      svg.selectAll("circle.complaint")
        .data(complaints)
        .enter()
        .append("circle")
        .attr("class", "complaint")
        .attr("cx", d => projection([d.Longitude, d.Latitude])[0])
        .attr("cy", d => projection([d.Longitude, d.Latitude])[1])
        .attr("r", 3)
        .attr("fill", "blue")
        .attr("opacity", 0.4);
    });
  </script>
</body>
</html>
